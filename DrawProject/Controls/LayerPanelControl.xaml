<UserControl
    x:Class="DrawProject.Controls.LayersPanelControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:DrawProject.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="400"
    d:DesignWidth="250"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:ObjectToBoolConverter x:Key="ObjectToBoolConverter" />
    </UserControl.Resources>

    <Border
        Background="White"
        BorderBrush="LightGray"
        BorderThickness="1">
        <DockPanel>
            <!--  Заголовок  -->
            <Border
                Padding="10,5"
                Background="#F0F0F0"
                BorderBrush="LightGray"
                BorderThickness="0,0,0,1"
                DockPanel.Dock="Top">
                <TextBlock
                    HorizontalAlignment="Center"
                    FontWeight="Bold"
                    Text="Layers" />
            </Border>

            <!--  Кнопки управления  -->
            <StackPanel
                Margin="5"
                HorizontalAlignment="Center"
                DockPanel.Dock="Bottom"
                Orientation="Horizontal">
                <Button
                    Width="30"
                    Command="{Binding AddLayerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Content="+"
                    ToolTip="Add new layer" />
                <Button
                    Width="30"
                    Margin="5,0,0,0"
                    Command="{Binding RemoveLayerCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Content="-"
                    ToolTip="Remove selected layer" />
            </StackPanel>

            <!--  Список слоёв  -->
            <ListBox
                x:Name="layersListBox"
                BorderThickness="0"
                ItemsSource="{Binding Layers, RelativeSource={RelativeSource AncestorType=UserControl}}"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                SelectedIndex="{Binding SelectedLayerIndex, RelativeSource={RelativeSource AncestorType=UserControl}}">
                <!--  Шаблон элемента  -->
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border
                            Margin="2"
                            Padding="3"
                            Background="Transparent"
                            CornerRadius="3">
                            <DockPanel Height="40">
                                <!--  Миниатюра  -->
                                <Border
                                    Width="30"
                                    Height="30"
                                    Margin="0,0,5,0"
                                    BorderBrush="#CCCCCC"
                                    BorderThickness="1"
                                    CornerRadius="3"
                                    DockPanel.Dock="Left">
                                    <Grid>
                                        <Rectangle Fill="White" />
                                        <Image Source="{Binding Source}" Stretch="UniformToFill" />
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            FontSize="9"
                                            Foreground="Gray"
                                            Text="IMG"
                                            Visibility="{Binding Source, Converter={StaticResource ObjectToBoolConverter}}" />
                                    </Grid>
                                </Border>

                                <!--  Кнопка выбора слоя (по клику на имя)  -->
                                <Button
                                    Padding="5,0"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Command="{Binding DataContext.SelectLayerCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                    CommandParameter="{Binding}"
                                    Content="{Binding Name}">
                                    <Button.Style>
                                        <Style BasedOn="{StaticResource {x:Type Button}}" TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="Transparent" CornerRadius="2">
                                                            <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center" />
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#F0F0F0" />
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Button.Style>
                                </Button>

                                <!--  Кнопки перемещения слоя  -->
                                <StackPanel
                                    Width="25"
                                    DockPanel.Dock="Right"
                                    Orientation="Vertical">
                                    <Button
                                        Height="15"
                                        Command="{Binding DataContext.MoveLayerUpCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}"
                                        Content="↑"
                                        FontSize="8"
                                        ToolTip="Move up" />
                                    <Button
                                        Height="15"
                                        Margin="0,2,0,0"
                                        Command="{Binding DataContext.MoveLayerDownCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}"
                                        Content="↓"
                                        FontSize="8"
                                        ToolTip="Move down" />
                                </StackPanel>
                            </DockPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

                <!--  Стиль выделенного элемента  -->
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                        <ContentPresenter />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#E3F2FD" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </DockPanel>
    </Border>
</UserControl>
